<html lang="en">
<head>
    <title>Bike Sharing</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../project.js" type="text/javascript" defer></script>
    <link rel="stylesheet" href="../project.css">
</head>
<div id="wrapper">

    <nav>
        <div id="mysidenav" class="sidenavigation">
            <a href="javascript:void(0)" id="closebutton" onclick="closeNav()">&times;</a>
            <a href="../index.html">Home</a>
            <a href="../login.html">Login</a>
            <a id="rider" href="../rider/rider-mainpage.html">&gt; Rider</a>
            <a id="customerservice" href="../custrep/custrep-mainpage.php">&gt; Customer Serv. Rep.</a>
            <a id="maintenance" class="active" href="technician-mainpage.html">&gt; Maintenance Tech.</a>
            <a href="../about.html">About</a>
            <a href="../faq.html">FAQ</a>
            <a href="../ourbikes.html">Our Bikes</a>
            <a href="../contact.html">Contact</a>
        </div>

        <ul id="desktopnavigation">
            <li><span class="dot"></span><a href="../index.html">Home</a></li>
            <li><span class="dot"></span><a href="../login.html">Login</a></li>
            <li class="submenu"><span>&gt; </span><a href="../rider/rider-mainpage.html">Rider</a></li>
            <li class="submenu"><span>&gt; </span><a href="../custrep/custrep-mainpage.php">Customer Service</a></li>
            <li class="submenu active"><span>&gt; </span><a class="active" href="technician-mainpage.html">Maintenance
                    Tech.</a></li>
            <li><span class="dot"></span><a href="../about.html">About</a></li>
            <li><span class="dot"></span><a href="../faq.html">FAQ</a></li>
            <li><span class="dot"></span><a href="../ourbikes.html">Our Bikes</a></li>
            <li><span class="dot"></span><a href="../contact.html">Contact</a></li>
        </ul>
    </nav>

    <div id="rightcol">

        <header>
            <div id="navicon">
                <img src="../images/navicon.png" alt="three horizontal bars" width="30" onclick="openNav()">
            </div>

            <h1>Bike Sharing</h1>
        </header>

        <div id="shadowbox">
            <main>
                <div>
                    <h3>MAINTENANCE TECHNICIAN - Bike Info</h3>

                    <form method="POST">

                        <p>
                            Table showing all bikes and their info. We should have a column for the "number of unique
                            riders who submitted issues for this bike". Will have to GROUP BY bike_id and then count
                            the unique rider IDs. This is to satisfy our GROUP BY requirements of the project. In our
                            formal spec document, under Deliverable 7, the third query we described is not very good.
                            Doesn't make sense in the current website design. So the query for this page should serve
                            as a replacement GROUP BY query.
                        </p>

                        <p>Table ordered by bike status.</p>

                    </form>
                </div>
            </main>

            <footer>
                <p>
                    Copyright &copy; 2018 Bike Sharing <br>
                    <a href="mailto:email@domain.com">email@domain.com</a>
                </p>
            </footer>
        </div>
    </div>
</div>
</html>

<?php

require "../server.php";
include "../print-table.php";

// Connect Oracle....
if ($db_conn) {

    // order bike table by bike status for technicians to attend to
    $result = executePlainSQL("SELECT B.BIKE_ID, DATE_PURCHASED, LATITUDE, LONGITUDE, IS_BROKEN, COUNT(MI.RIDER_ID) AS NUMBER_OF_ISSUES
                                          FROM MAINTENANCE_ISSUE MI
                                          RIGHT JOIN BIKE B ON MI.BIKE_ID = B.BIKE_ID
                                          GROUP BY B.BIKE_ID, DATE_PURCHASED, LATITUDE, LONGITUDE, IS_BROKEN
                                          ORDER BY IS_BROKEN DESC");

    $columnNames = array("Bike ID", "Date Purchased", "Latitude", "Longitude", "Bike Broken?", "Number of Issues");
    printTable($result, $columnNames);
    OCICommit($db_conn);

    // Commit to save changes...
    OCILogoff($db_conn);
} else {
    echo "cannot connect";
    $e = OCI_Error(); // For OCILogon errors pass no handle
    echo htmlentities($e['message']);
}
